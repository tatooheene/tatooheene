---
title: "Discounting with tatooheene"
author: "The tatooheene team"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_vignette:
    toc: true
    number_sections: false
vignette: >
  %\VignetteIndexEntry{Discounting with tatooheene}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, comment = "#>", fig.width = 7, fig.height = 4, dpi = 120
)
library(tatooheene)
```

## What this vignette covers

-   What the **discounting** is and where it lives in `tatooheene::df_fp`.
-   The formula and meaning of the annuity factor and the annual depreciation and interest charge.
-   How to call `discount_value()` and `discount_stream()`and how to interpret there outputs.

## Background

Costs and health outcomes that are expected to occur in the future are generally values less than those that occur in the present, and so it is recommended that they be discounted in economic analyses. This is typically done by presenting the costs and health outcomes as a stream of values over time, applying a discounting factor to each value, and then aggregating them to obtain the ‘present value’ of each stream.

The discount factor is increasing over time, based on an underlying fixed discount rate. In the Netherlands, we use a discount rate of 1.5% for health effects and 3% for costs.

*Text adapted from Dutch costing manual and Discount Rate [online]. (2016). York; York Health Economics Consortium; 2016. <https://yhec.co.uk/glossary/discount-rate/>.*

## Formulas

The most common method is to calculate a net present value based on constant discounting.

When taking costs as an example, the present value of costs ($C$) from the current year ($t=0$) up to and including year $n$ under a constant discounting model is:

$$
C \;=\; \sum_{t=0}^{n} \frac{K_t}{(1+i)^{t}}
$$

where $K_t$ denotes the costs in year $t$ and $i$ is the constant discount rate.\
No discounting is applied at $t=0$.

Please note that the net present value for costs, $C$, could also be the net present value of an health effect, e.g. QALYs.

## Difference between `discount_value()` and `discount_stream()`

`discount_value()` converts a single future value (cost or health effect) at time `t` to its present value using a discount rate. Use it when you have one payment or health outcome occurring in a specific year.

`discount_stream()` converts a *vector* of values (costs or health effects) occurring at multiple times to a single present value by discounting each element and aggregating.

## R example from guidelines

In an economic evaluation annual costs for standard of care (SoC) are estimated to be €100.00. Without discounting, the costs after 3 years are €300.00.

```{r no-discount}
c_annual <- 100
c_t3_undiscounted <- 3 * c_annual
c_t3_undiscounted
```

We define the discount rate (`d_c`) of 3% and make a vector/stream of these costs for the three years.

```{r discount-rate}
d_c <- 0.03 # The discount rate for costs 
v_c_SoC <- rep(c_annual, 3) # Vector/stream of costs values on all years for standard of care 
names(v_c_SoC) <- c("Year 1", "Year2", "Year 3")
```

This example is a stream of costs, therefore, we need the function `discount_stream`. Using the formulate this gives us:

```{r example-guideline}
discount_stream(values = v_c_SoC, discount_rate = "costs" )
```

You can sum these values using the basic sum function or set the argument `aggregate` to `TRUE`

```{r example-guideline}
sum(discount_stream(values = v_c_SoC, discount_rate = "costs" ))
discount_stream(values = v_c_SoC,  discount_rate = "costs", aggregate = T)
```

\##@Q do we like aggregate? How about rounding? \##@Q Year or time?? - laten we jaar gebruiken - voor discount -\> functie en uitleggen

## R example with discount value

If we like to only discount the annual costs at year 3. We can use `discountvalue`

```{r example-value}
discount_value(value = 100, discount_rate = "costs", year = 3)
```

## R example for health effects

## Input validation & common messages
